



<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Skriptum zur Lehrveranstaltung Serverseitige Softwareentwicklung">
      
      
      
        <meta name="author" content="Stefan Huber">
      
      
        <meta name="lang:clipboard.copy" content="In Zwischenablage kopieren">
      
        <meta name="lang:clipboard.copied" content="In Zwischenablage kopiert">
      
        <meta name="lang:search.language" content="de">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="Keine Suchergebnisse">
      
        <meta name="lang:search.result.one" content="1 Suchergebnis">
      
        <meta name="lang:search.result.other" content="# Suchergebnisse">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.2">
    
    
      
        <title>Datenbanken - Serverseitige Softwareentwicklung</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#arbeiten-mit-datenbanken" tabindex="1" class="md-skip">
        Zum Inhalt
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Serverseitige Softwareentwicklung" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Serverseitige Softwareentwicklung
            </span>
            <span class="md-header-nav__topic">
              
                Datenbanken
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Suchbegriff eingeben
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/stefanhuber/serverseitige-softwareentwicklung/" title="Quellcode" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Serverseitige Softwareentwicklung" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Serverseitige Softwareentwicklung
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/stefanhuber/serverseitige-softwareentwicklung/" title="Quellcode" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      PHP
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        PHP
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../01/" title="Grundlagen" class="md-nav__link">
      Grundlagen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../02/" title="Arrays" class="md-nav__link">
      Arrays
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../03/" title="Superglobals" class="md-nav__link">
      Superglobals
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../04/" title="Funktionen" class="md-nav__link">
      Funktionen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../05/" title="OOP" class="md-nav__link">
      OOP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../06/" title="Sessions und Cookies" class="md-nav__link">
      Sessions und Cookies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../07/" title="Errors und Exceptions" class="md-nav__link">
      Errors und Exceptions
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Datenbanken
      </label>
    
    <a href="./" title="Datenbanken" class="md-nav__link md-nav__link--active">
      Datenbanken
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Inhaltsverzeichnis</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#verbindung-mit-dsn" class="md-nav__link">
    Verbindung mit DSN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exec-und-query" class="md-nav__link">
    Exec und Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepared-statements" class="md-nav__link">
    Prepared Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert-statement" class="md-nav__link">
    INSERT Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-statement" class="md-nav__link">
    UPDATE Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-statement" class="md-nav__link">
    DELETE Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-statement" class="md-nav__link">
    CREATE Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details-zu-fetch" class="md-nav__link">
    Details zu Fetch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeilenweises-auslesen" class="md-nav__link">
    Zeilenweises Auslesen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetch-ergebniszeile" class="md-nav__link">
    Fetch Ergebniszeile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beispiel-fetchobject" class="md-nav__link">
    Beispiel fetchObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weitere-ressourcen" class="md-nav__link">
    Weitere Ressourcen
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../09/" title="Quellcode einbinden" class="md-nav__link">
      Quellcode einbinden
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../10/" title="Arbeiten mit Projektabhängigkeiten" class="md-nav__link">
      Arbeiten mit Projektabhängigkeiten
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/01/" title="PHP Installation" class="md-nav__link">
      PHP Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/02/" title="PHP Webserver" class="md-nav__link">
      PHP Webserver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/03/" title="PHP Konfiguration" class="md-nav__link">
      PHP Konfiguration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tutorials/04/" title="Arbeiten mit SQLite" class="md-nav__link">
      Arbeiten mit SQLite
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Übungstutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Übungstutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../exercises/01/" title="Übungsblatt 1 - Übung 0" class="md-nav__link">
      Übungsblatt 1 - Übung 0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Inhaltsverzeichnis</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#verbindung-mit-dsn" class="md-nav__link">
    Verbindung mit DSN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exec-und-query" class="md-nav__link">
    Exec und Query
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepared-statements" class="md-nav__link">
    Prepared Statements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#insert-statement" class="md-nav__link">
    INSERT Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-statement" class="md-nav__link">
    UPDATE Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delete-statement" class="md-nav__link">
    DELETE Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-statement" class="md-nav__link">
    CREATE Statement
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details-zu-fetch" class="md-nav__link">
    Details zu Fetch
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeilenweises-auslesen" class="md-nav__link">
    Zeilenweises Auslesen
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fetch-ergebniszeile" class="md-nav__link">
    Fetch Ergebniszeile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beispiel-fetchobject" class="md-nav__link">
    Beispiel fetchObject
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#weitere-ressourcen" class="md-nav__link">
    Weitere Ressourcen
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/stefanhuber/serverseitige-softwareentwicklung/edit/master/docs/php/08.md" title="Seite editieren" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="arbeiten-mit-datenbanken">Arbeiten mit Datenbanken</h1>
<p>PHP Data Objects (PDO) ist eine Datenbankabstraktionsschicht, welche einen einheitlichen Zugriff auf unterschiedliche DBMS über eine Schnittstelle ermöglicht. Somit kann zB zur Entwicklungszeit SQLite verwendet werden und in der Produktivumgebung auf Oracle gesetzt werden. PDO bietet folgende Vorteile:</p>
<ul>
<li>Sicherheit: Escaping von Queryparameter über Prepared Statements</li>
<li>Usability: Viele nützliche Funktionen um einen unproblematischen Zugriff auf das DBMS zu realisieren</li>
<li>Wiederverwendbarkeit: Einheitliche API für den Zugriff auf unterschiedliche DBMS</li>
</ul>
<p>Für die Arbeit mit PDO werden generell 2 Klassen benötigt. Die Klasse <code>PDO</code> als Einstiegspunkt und die Klasse <code>PDOStatement</code>, welche einzelne SQL-Statements repräsentiert.</p>
<h2 id="verbindung-mit-dsn">Verbindung mit DSN</h2>
<p>Um die Verbindung zu einem DBMS aufzubauen wird ein gültiger Data Source Name (DSN) benötigt. DSNs sind generell nach einem einfachen Schema aufgebaut. Dannach folgen unterschiedliche Verbindungsparameter als Schlüssel/Wert Paare mit <code>;</code> getrennt.</p>
<p>Als wichtige Verbindungsparameter sind dabei <code>host</code>, <code>dbname</code>, <code>port</code> und <code>charset</code> zu nennen. Im folgenden findet sich ein Beispiel eines DSN für eine Mysql-Datenbank mit dem Namen <code>test</code> auf Port <code>3306</code> und einem <code>utf-8</code> Charset:</p>
<div class="codehilite"><pre><span></span><span class="n">mysql</span><span class="o">:</span><span class="n">host</span><span class="o">=</span><span class="n">localhost</span><span class="o">;</span><span class="n">dbname</span><span class="o">=</span><span class="n">test</span><span class="o">;</span><span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="o">;</span><span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
</pre></div>


<p>Mit der Klasse <code>PDO</code> kann die tatsächliche Verbindung zu einem DBMS über den DSN aufgebaut werden. Je nach verwendetem DBMS sind ein gültiger Username bzw. Passwort wichtige Ergänzungen zum DSN. Im Folgenden Code-Abschnitt wird die Verbindung zu einer Mysql-Datenbank aufgebaut: </p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$dsn</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=localhost;dbname=test;port=3306;charset=utf-8&quot;</span><span class="p">;</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span><span class="p">;</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s2">&quot;geheim&quot;</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$pdo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$username</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;ERROR: &quot;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>Die oben erzeugte Variable <code>$pdo</code> wird in den weiteren Quellcode-Abschnitten dieses Textes wiederverwendet. </p>
<h2 id="exec-und-query">Exec und Query</h2>
<p>Die Klasse <code>PDO</code> bietet zwei generische Methoden (<code>exec</code> und <code>query</code>) um mit einer Datenbank zu arbeiten.</p>
<p>Die Methode <code>exec</code> kann genutzt werden um ein SQL-Statement auszuführen. Als Ergebnis liefert die Methode "nur" die Anzahl der Zeilen, welche durch das SQL-Statement betroffen worden sind. Im folgenden Beispiel wird ein DELETE-Statement mit <code>exec</code> ausgeführt. Als Ergebnis wird die Anzahl der gelöschten Zeilen an die Variable <code>$count</code> zurückgegeben:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s2">&quot;DELETE FROM products WHERE price &gt; 10&quot;</span><span class="p">);</span>
</pre></div>


<p>Die Methode <code>query</code> erzeugt eine Instanz der Klasse <code>PDOStatement</code>. Ein <code>PDOStatement</code> stellt unter anderem eine Ergebnismenge dar und kann iteriert werden:</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM products ORDER BY price&quot;</span><span class="p">;</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot; &quot;</span> <span class="o">.</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Die Methoden <code>exec</code> und <code>query</code> sollten nur für statische SQL-Statements verwendet werden. Variable Parameter werden nicht escaped und sind daher offen für SQL-Injections.</p>
</div>
<h2 id="prepared-statements">Prepared Statements</h2>
<p>SQL-Queries benötigen häufig Parameter aus dem PHP-Programm. Unter anderem aus Sicherheitsgründen sollten dazu Prepared Statements genutzt werden.</p>
<p>Im Beispiel sollen alle Attribute eines Produktes anhand der ID des Produktes abgefragt werden. Die ID des Produktes könnte zB über den Querystring der URI an das PHP Programm übergeben werden.</p>
<p>Die Variable <code>$pdo</code> stellt eine gültige Datenbankverbindung dar (siehe oben). Folgende Schritte werden im Skript durchgeführt:</p>
<ul>
<li>Es wird ein Prepared Statement erzeugt (Methode <code>prepare</code>). Mit <code>?</code> werden Platzhalter für variable Bestandteile der SQL-Query definiert.</li>
<li>Das erzeugte Prepared Statement kann über die Methode <code>execute</code> ausgeführt werden. Dabei wird ein Array übergeben, dass alle definierten Platzhalter der Reihe nach ersetzt. Alle übergebenen Werte werden escaped, sodass es zu keiner SQL-Injection kommen kann.</li>
<li>Die Methode <code>fetch</code> kann genutzt werden um das Query-Resultat zeilenweise abzufragen. <code>fetch</code> gibt <code>false</code> zurück, falls das Ergebnis leer ist.</li>
</ul>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM products WHERE id = ?&#39;</span><span class="p">);</span>

<span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]);</span>

<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">();</span>
</pre></div>


<h2 id="insert-statement">INSERT Statement</h2>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;INSERT INTO products (name, description, price) VALUES (?, ?, ?)&quot;</span><span class="p">);</span>
<span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s2">&quot;Tolles Produkt&quot;</span><span class="p">,</span> <span class="s2">&quot;Ein schönes Produkt mit vielen Extras...&quot;</span><span class="p">,</span> <span class="mf">5.99</span><span class="p">]);</span>
</pre></div>


<h2 id="update-statement">UPDATE Statement</h2>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;UPDATE products SET name = ? WHERE id = ?&quot;</span><span class="p">);</span>
<span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="s2">&quot;Neuer Produktname&quot;</span><span class="p">,</span> <span class="mi">13</span><span class="p">]);</span>
</pre></div>


<h2 id="delete-statement">DELETE Statement</h2>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;DELETE FROM products WHERE id = ?&quot;</span><span class="p">);</span>
<span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">([</span><span class="mi">13</span><span class="p">]);</span>
</pre></div>


<h2 id="create-statement">CREATE Statement</h2>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$create</span> <span class="o">=</span> <span class="s2">&quot;CREATE TABLE IF NOT EXISTS products (</span>
<span class="s2">    id INTEGER PRIMARY KEY AUTOINCREMENT,</span>
<span class="s2">    name TEXT NOT NULL,</span>
<span class="s2">    description TEXT NOT NULL,</span>
<span class="s2">    image TEXT NOT NULL,</span>
<span class="s2">    price REAL</span>
<span class="s2">)&quot;</span><span class="p">;</span>

<span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="nv">$create</span><span class="p">);</span>
</pre></div>


<h2 id="details-zu-fetch">Details zu Fetch</h2>
<h3 id="zeilenweises-auslesen">Zeilenweises Auslesen</h3>
<p>Die Methode <code>fetch</code> liefert immer nur eine Ergebniszeile je Aufruf. Die Methode fungiert dabei wie ein Cursor und springt die Ergebnismenge zeilenweise durch. Mit einer Schleife kann somit durch die Ergebnismenge iteriert werden. Falls die Ergenbismenge leer ist oder der Cursor am Ende angekommen ist, liefert die Methode <code>fetch</code> <code>false</code> als Rückgabewert.</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s1">&#39;SELECT name, price FROM products&#39;</span><span class="p">);</span>
<span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$product</span> <span class="o">=</span> <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">())</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$product</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;: € &quot;</span> <span class="o">.</span> <span class="nv">$product</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h3 id="fetch-ergebniszeile">Fetch Ergebniszeile</h3>
<p>Die Repräsentation einer Ergebniszeile kann über den sog. <code>Fetch-Style</code> angepasst werden. PDO bietet 11 verschiedene Fetch-Styles. Die wichtigsten sollen kurz zusammengefasst werden:</p>
<ul>
<li><code>FETCH_ASSOC</code>: Das Ergebnis wird als assoziatives Array repräsentiert.</li>
<li><code>FETCH_NUM</code>: Das Ergebnis wird als indexiertes Array repräsentiert.</li>
<li><code>FETCH_BOTH</code>: Dies ist die default Einstellung. Eine Kombination aus <code>FETCH_ASSOC</code> und <code>FETCH_NUM</code>.</li>
<li><code>FETCH_OBJ</code>: Das Ergebnis wird als "anonymes" Objekt (der Klasse <code>stdClass</code>) repräsentiert. Die Spalten werden auf Objekteigenschaften gemappt.</li>
<li><code>FETCH_LAZY</code>: Ähnlich zu <code>FETCH_OBJ</code>, die Attribute des Objektes werden jedoch erst zugewiesen, wenn sie abgefragt werden.</li>
<li><code>FETCH_CLASS</code>: Das Ergebnis wird innerhalb eines Objektes der entsprechenden Klasse repräsentiert.</li>
</ul>
<p>Die Methode <code>fetchObject</code> kann komfortabel anstelle der Angabe des <code>FETCH_OBJ</code> oder <code>FETCH_CLASS</code> Style verwendet werden.</p>
<h3 id="beispiel-fetchobject">Beispiel fetchObject</h3>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Product</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$price</span><span class="p">;</span>

    <span class="c1">// ... getter/setter</span>
<span class="p">}</span>

<span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$pdo</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="s2">&quot;SELECT id, name, price FROM products&quot;</span><span class="p">);</span>
<span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

<span class="c1">// $product ist eine Instanz der Klasse Product:</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">fetchObject</span><span class="p">(</span><span class="nx">Product</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</pre></div>


<h2 id="weitere-ressourcen">Weitere Ressourcen</h2>
<ul>
<li>Die PHP-Dokumentation bietet zu <a href="https://www.php.net/manual/en/book.pdo.php">PDO</a> und allen Klassen und Methoden eine ausführliche Beschreibung.</li>
<li>Die Website <a href="https://phpdelusions.net/">phpdelusions.net</a> bietet ein umfangreiches <a href="https://phpdelusions.net/pdo">Tutorial zu PDO</a>.</li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../07/" title="Errors und Exceptions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Zurück
                </span>
                Errors und Exceptions
              </span>
            </div>
          </a>
        
        
          <a href="../09/" title="Quellcode einbinden" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Weiter
                </span>
                Quellcode einbinden
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            CC-BY-SA / Stefan Huber
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c648116f.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../../assets/javascripts/lunr/lunr.de.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>